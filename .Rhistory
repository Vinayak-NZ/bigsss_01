typeof(data_imputed_pooled_all$sex)
typeof(data_imputed_pooled_all$age_cat)
typeof(data_imputed_pooled_all$time)
class(data_imputed_pooled_all$time)
class(data_imputed_pooled_all$age_cat)
class(data_imputed_pooled_all$stress)
mice_pooled_model_01 <- lmer_pool(mice_models_01, level = .95)
mice_pooled_model_02 <- lmer_pool(mice_models_02, level = .95)
mice_pooled_output_model_01 <- summary(mice_pooled_model_01)
mice_pooled_output_model_02 <- summary(mice_pooled_model_02)
mice_treatment_effect_model_01 <- unlist(mice_models_summary_01, use.names=FALSE)
mice_treatment_effect_model_02 <- unlist(mice_models_summary_02, use.names=FALSE)
mice_pooled_output_model_02 <- summary(mice_pooled_model_02)
model_stress <- lmer(WFI ~ Group*time*stress + age_cat + sex + (1 | id),
data = data_imputed_pooled_all)
summary(model_stress)
anova(model_non_linear, model_stress)
anova(model_linear, model_stress)
cor(data_imputed_pooled_all$WFI, data_imputed_pooled_all$stress)
cor(data_imputed_pooled_all$WFI, data_imputed_pooled_all$stress, method = 'spearman')
cor.test(data_imputed_pooled_all$WFI, data_imputed_pooled_all$stress, method = 'spearman')
cor.test(data_imputed_pooled_all$WFI, data_imputed_pooled_all$stress, method = c("spearman"))
wfi <- data_imputed_pooled_all$WFI
stress <- data_imputed_pooled_all$stress
cor.test(wfi, stress, method = c("spearman"))
?cor.test
stress
cor.test(wfi, as.numeric(stress), method = c("spearman"))
source("R/00_load_packages.R")
source("R/00_load_packages.R")
source("R/01_load_data.R")
source("R/02_edit_data.R")
source("R/03_impute_data.R")
source("R/04_post_impute_edits.R")
source("R/04_post_impute_single.R")
data_imputed_long <- do.call(rbind, data_imputed_output)
model_brm_02 <- brm(WFI ~ Group*time*I(SCON^2) + Group*time*SCON + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_long,
chains = 2,
iter = 1000,
warmup = 500,
control = list(adapt_delta = 0.8))
saveRDS(model_brm_02, file = "output/model_brm_02_2025_03_12.rds")
summary(model_brm_02)
# linear-model
model_linear <- lmer(WFI ~ Group*time*SCON + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
REML = FALSE,
data = data_imputed_pooled_all)
# linear-model
model_linear <- glmer(WFI ~ Group*time*SCON + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
REML = FALSE,
data = data_imputed_pooled_all)
# linear-model
model_linear <- glmer(WFI ~ Group*time*SCON + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_pooled_all)
# non-linear-model
model_non_linear <- glmer(WFI ~ Group*time*I(SCON^2) + Group*time*SCON + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_pooled_all)
data_imputed_pooled_all$SCON_scaled <- scale(data_imputed_pooled_all$SCON)
# linear-model
model_linear <- glmer(WFI ~ Group*time*SCON_scaled + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_pooled_all)
# non-linear-model
model_non_linear <- glmer(WFI ~ Group*time*I(SCON_scaled^2) + Group*time*SCON_scaled + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_pooled_all)
# linear-model
model_linear <- glmer(WFI ~ Group*time*SCON_scaled + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_pooled_all,
control = glmerControl(optimizer = "bobyqa"))
# non-linear-model
model_non_linear <- glmer(WFI ~ Group*time*I(SCON_scaled^2) + Group*time*SCON_scaled + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_pooled_all,
control = glmerControl(optimizer = "bobyqa"))
# Compare models using ANOVA
anova(model_linear, model_non_linear)
# summary of non-linear-model
summary(model_non_linear)
# non-linear-model
model_non_linear <- glmer(WFI ~ Group*time*I(SCON_scaled^2) + Group*time*SCON_scaled + stress + age_cat + sex + (1 | id),
family = Gamma(link = "log"),
data = data_imputed_pooled_all,
control = glmerControl(optimizer = "nloptwrap", calc.derivs = FALSE))
# Compare models using ANOVA
anova(model_linear, model_non_linear)
# summary of non-linear-model
summary(model_non_linear)
test <- glmer(SCON ~ Group*time + stress + age_cat + sex + (1 | id),
family = gaussian(link = "log"),
data = data_imputed_pooled_all)
test <- glmer(SCON ~ Group*time + stress + age_cat + sex + (1 | id),
family = gaussian(link = "log"),
data = data_imputed_pooled_all,
control = glmerControl(optimizer = "nloptwrap", calc.derivs = FALSE))
summary(test)
model_01 <- SCON ~ Group*time + stress + age_cat + sex + (1 | id)
model_02 <- WFI ~ Group*time*I(SCON^2) + Group*time*SCON + stress + age_cat + sex + (1 | id)
mice_models_01 <- list()
mice_models_02 <- list()
mice_models_summary_01 <- list()
mice_models_summary_02 <- list()
M <- length(data_imputed_output)
for (mm in 1:M){
mice_models_01[[mm]] <- lme4::glmer(model_01,
data = data_imputed_output[[mm]],
family = gaussian(link = "log"),
control = glmerControl(optimizer = "nloptwrap", calc.derivs = FALSE))
mice_models_summary_01[[mm]] <- summary(mice_models_01[[mm]])$coefficients[2]
mice_models_02[[mm]] <- lme4::glmer(model_02,
data = data_imputed_output[[mm]],
family = Gamma(link = "log"),
control = glmerControl(optimizer = "nloptwrap", calc.derivs = FALSE))
mice_models_summary_02[[mm]] <- summary(mice_models_02[[mm]])$coefficients[2]
}
saveRDS(model_01_list, file = "output/model_01_list.RData")
saveRDS(mice_models_01, file = "output/model_01_list.RData")
saveRDS(mice_models_02, file = "output/model_02_list.RData")
saveRDS(mice_models_summary_01, file = "output/model_01_summary.RData")
saveRDS(mice_models_summary_02, file = "output/model_02_summary.RData")
mice_pooled_model_01 <- lmer_pool(mice_models_01, level = .95)
mice_pooled_model_02 <- lmer_pool(mice_models_02, level = .95)
mice_pooled_output_model_01 <- summary(mice_pooled_model_01)
summary(mice_models_01[[1]])
test <- summary(mice_models_01[[1]])
test$coefficients
test$coefficients[[2]]
test$coefficients[2]
sd_model_01 <- lme4::glmer(SCON ~ Group*time + stress + Age + sex + (1 | id),
data = data_imputed_output[[mm]],
family = gaussian(link = "log"),
control = glmerControl(optimizer = "nloptwrap", calc.derivs = FALSE))
sd_model_02 <- lme4::glmer(WFI ~ Group*time*I(SCON^2) + Group*time*SCON + stress + age_cat + sex + (1 | id),
data = data_imputed_output[[mm]],
family = Gamma(link = "log"),
control = glmerControl(optimizer = "nloptwrap", calc.derivs = FALSE))
summary(sd_model_01)
summary(sd_model_02)
source("R/00_load_packages.R")
source("R/01_load_data.R")
source("R/02_edit_data.R")
source("R/03_impute_data.R")
source("R/04_post_impute_edits.R")
source("R/04_post_impute_single.R")
imp <- as.mids(data_imputed_output)
View(data_imputed_output)
?as.mids
data_imputed_long <- do.call(rbind, data_imputed_output)
imp <- as.mids(data_imputed_long)
test2 <- complete(data_imputed, action = "long", include = TRUE)
View(test2)
View(test2)
View(data_imputed_output)
names(data_imputed_output[[1]])
original_data <- data_input
original_data[[".id"]] <- original_data[["id"]]
original_data[[".imp"]] <- 0
original_data <- data_input[, c(".imp",
".id",
"id",
"group",
"sex",
"age_cat",
"time",
"stress",
"SCON",
"WFI")]
original_data <- data_input
original_data <- original_data[, c("id",
"Group",
"Age",
"v_236",
"v_534",
"SCON_T1",
"SCON_T2",
"WFI_T1",
"WFI_T2")]
setDT(original_data)
original_data <- melt(original_data,
id.vars = c("id",
"Group",
"Age",
"v_236",
"v_534"),
measure.vars = list(c("SCON_T1", "SCON_T2"), c("WFI_T1", "WFI_T2")),
variable.name = "time",
value.name = c("SCON", "WFI"))
original_data[, "time"] <- ifelse(original_data[, "time"] == 1,
"baseline", "follow-up")
original_data$group <- as.factor(original_data$group)
original_data$time <- as.factor(original_data$time)
original_data$sex <- as.factor(original_data$v_236)
original_data[["SCON"]] <-
abs(as.numeric(original_data[["SCON"]]))
original_data[["WFI"]] <-
abs(as.numeric(original_data[["WFI"]]))
original_data[["age_cat"]] <-
ifelse(original_data[["Age"]] < 31, 1,
ifelse(original_data[["Age"]] >= 31 &
original_data[["Age"]] < 41, 2,
ifelse(original_data[["Age"]] >= 41 &
original_data[["Age"]] < 51, 3, 4)))
original_data$age_cat <- factor(original_data[["age_cat"]],
order = TRUE,
levels = c(1, 2, 3, 4))
original_data[["stress"]] <- factor(original_data[["v_534"]],
order = TRUE,
levels = c(1, 2, 3, 4, 5))
original_data <- as.data.frame(original_data)
original_data$.id <- original_data$id
original_data$.imp <- 0
original_data <- original_data[, c(".imp",
".id",
"id",
"group",
"sex",
"age_cat",
"time",
"stress",
"SCON",
"WFI")]
View(data_imputed_long)
data_imputed_long <- data_imputed_long[, c(".imp",
".id",
"id",
"group",
"sex",
"age_cat",
"time",
"stress",
"SCON",
"WFI")]
# create single imputed dataset
data_imputed_pooled <- merge_imputations(data_impute_input,
data_imputed,
ori = data_impute_input)
data_imputed_pooled <- cbind(data_input[, exclude_vars], data_imputed_pooled)
# create mice output
data_imputed_output <- list()
for (i in 1:data_imputed$m){
data_imputed_output[[i]] <- complete(data_imputed, i)
data_imputed_output[[i]] <- cbind(data_input[, exclude_vars], data_imputed_output[[i]])
}
test2 <- complete(data_imputed, action = "long", include = TRUE)
for (i in 1:length(data_imputed_output)){
data_imputed_output[[i]] <- data_imputed_output[[i]][, c("id",
"Group",
"Age",
"v_236",
"v_534",
"SCON_T1",
"SCON_T2",
"WFI_T1",
"WFI_T2")]
setDT(data_imputed_output[[i]])
data_imputed_output[[i]] <- melt(data_imputed_output[[i]],
id.vars = c("id",
"Group",
"Age",
"v_236",
"v_534"),
measure.vars = list(c("SCON_T1", "SCON_T2"), c("WFI_T1", "WFI_T2")),
variable.name = "time",
value.name = c("SCON", "WFI"))
data_imputed_output[[i]][, "time"] <- ifelse(data_imputed_output[[i]][, "time"] == 1,
"baseline", "follow-up")
data_imputed_output[[i]]$group <- as.factor(data_imputed_output[[i]]$group)
data_imputed_output[[i]]$time <- as.factor(data_imputed_output[[i]]$time)
data_imputed_output[[i]]$sex <- as.factor(data_imputed_output[[i]]$v_236)
data_imputed_output[[i]][["SCON"]] <-
abs(as.numeric(data_imputed_output[[i]][["SCON"]]))
data_imputed_output[[i]][["WFI"]] <-
abs(as.numeric(data_imputed_output[[i]][["WFI"]]))
data_imputed_output[[i]][["age_cat"]] <-
ifelse(data_imputed_output[[i]][["Age"]] < 31, 1,
ifelse(data_imputed_output[[i]][["Age"]] >= 31 &
data_imputed_output[[i]][["Age"]] < 41, 2,
ifelse(data_imputed_output[[i]][["Age"]] >= 41 &
data_imputed_output[[i]][["Age"]] < 51, 3, 4)))
data_imputed_output[[i]]$age_cat <- factor(data_imputed_output[[i]][["age_cat"]],
order = TRUE,
levels = c(1, 2, 3, 4))
data_imputed_output[[i]][["stress"]] <- factor(data_imputed_output[[i]][["v_534"]],
order = TRUE,
levels = c(1, 2, 3, 4, 5))
data_imputed_output[[i]] <- as.data.frame(data_imputed_output[[i]])
data_imputed_output[[i]]$.id <- data_imputed_output[[i]]$id
data_imputed_output[[i]]$.imp <- i
data_imputed_output[[i]] <- data_imputed_output[[i]][, c(".imp",
".id",
"id",
"group",
"sex",
"age_cat",
"time",
"stress",
"SCON",
"WFI")]
}
data_imputed_long <- do.call(rbind, data_imputed_output)
original_data <- data_input
original_data <- original_data[, c("id",
"Group",
"Age",
"v_236",
"v_534",
"SCON_T1",
"SCON_T2",
"WFI_T1",
"WFI_T2")]
setDT(original_data)
original_data <- melt(original_data,
id.vars = c("id",
"Group",
"Age",
"v_236",
"v_534"),
measure.vars = list(c("SCON_T1", "SCON_T2"), c("WFI_T1", "WFI_T2")),
variable.name = "time",
value.name = c("SCON", "WFI"))
original_data[, "time"] <- ifelse(original_data[, "time"] == 1,
"baseline", "follow-up")
original_data$group <- as.factor(original_data$group)
original_data$time <- as.factor(original_data$time)
original_data$sex <- as.factor(original_data$v_236)
original_data[["SCON"]] <-
abs(as.numeric(original_data[["SCON"]]))
original_data[["WFI"]] <-
abs(as.numeric(original_data[["WFI"]]))
original_data[["age_cat"]] <-
ifelse(original_data[["Age"]] < 31, 1,
ifelse(original_data[["Age"]] >= 31 &
original_data[["Age"]] < 41, 2,
ifelse(original_data[["Age"]] >= 41 &
original_data[["Age"]] < 51, 3, 4)))
original_data$age_cat <- factor(original_data[["age_cat"]],
order = TRUE,
levels = c(1, 2, 3, 4))
original_data[["stress"]] <- factor(original_data[["v_534"]],
order = TRUE,
levels = c(1, 2, 3, 4, 5))
original_data <- as.data.frame(original_data)
original_data$.id <- original_data$id
original_data$.imp <- 0
original_data <- original_data[, c(".imp",
".id",
"id",
"group",
"sex",
"age_cat",
"time",
"stress",
"SCON",
"WFI")]
test3 <- rbind(original_data, data_imputed_long)
imp <- as.mids(test3)
View(test3)
# create single imputed dataset
data_imputed_pooled <- merge_imputations(data_impute_input,
data_imputed,
ori = data_impute_input)
data_imputed_pooled <- cbind(data_input[, exclude_vars], data_imputed_pooled)
# create mice output
data_imputed_output <- list()
for (i in 1:data_imputed$m){
data_imputed_output[[i]] <- complete(data_imputed, i)
data_imputed_output[[i]] <- cbind(data_input[, exclude_vars], data_imputed_output[[i]])
}
for (i in 1:length(data_imputed_output)){
data_imputed_output[[i]] <- data_imputed_output[[i]][, c("id",
"Group",
"Age",
"v_236",
"v_534",
"SCON_T1",
"SCON_T2",
"WFI_T1",
"WFI_T2")]
setDT(data_imputed_output[[i]])
data_imputed_output[[i]] <- melt(data_imputed_output[[i]],
id.vars = c("id",
"Group",
"Age",
"v_236",
"v_534"),
measure.vars = list(c("SCON_T1", "SCON_T2"), c("WFI_T1", "WFI_T2")),
variable.name = "time",
value.name = c("SCON", "WFI"))
data_imputed_output[[i]][, "time"] <- ifelse(data_imputed_output[[i]][, "time"] == 1,
"baseline", "follow-up")
data_imputed_output[[i]]$group <- as.factor(data_imputed_output[[i]]$Group)
data_imputed_output[[i]]$time <- as.factor(data_imputed_output[[i]]$time)
data_imputed_output[[i]]$sex <- as.factor(data_imputed_output[[i]]$v_236)
data_imputed_output[[i]][["SCON"]] <-
abs(as.numeric(data_imputed_output[[i]][["SCON"]]))
data_imputed_output[[i]][["WFI"]] <-
abs(as.numeric(data_imputed_output[[i]][["WFI"]]))
data_imputed_output[[i]][["age_cat"]] <-
ifelse(data_imputed_output[[i]][["Age"]] < 31, 1,
ifelse(data_imputed_output[[i]][["Age"]] >= 31 &
data_imputed_output[[i]][["Age"]] < 41, 2,
ifelse(data_imputed_output[[i]][["Age"]] >= 41 &
data_imputed_output[[i]][["Age"]] < 51, 3, 4)))
data_imputed_output[[i]]$age_cat <- factor(data_imputed_output[[i]][["age_cat"]],
order = TRUE,
levels = c(1, 2, 3, 4))
data_imputed_output[[i]][["stress"]] <- factor(data_imputed_output[[i]][["v_534"]],
order = TRUE,
levels = c(1, 2, 3, 4, 5))
data_imputed_output[[i]] <- as.data.frame(data_imputed_output[[i]])
data_imputed_output[[i]]$.id <- data_imputed_output[[i]]$id
data_imputed_output[[i]]$.imp <- i
data_imputed_output[[i]] <- data_imputed_output[[i]][, c(".imp",
".id",
"id",
"group",
"sex",
"age_cat",
"time",
"stress",
"SCON",
"WFI")]
}
data_imputed_long <- do.call(rbind, data_imputed_output)
original_data <- data_input
original_data <- original_data[, c("id",
"Group",
"Age",
"v_236",
"v_534",
"SCON_T1",
"SCON_T2",
"WFI_T1",
"WFI_T2")]
setDT(original_data)
original_data <- melt(original_data,
id.vars = c("id",
"Group",
"Age",
"v_236",
"v_534"),
measure.vars = list(c("SCON_T1", "SCON_T2"), c("WFI_T1", "WFI_T2")),
variable.name = "time",
value.name = c("SCON", "WFI"))
original_data[, "time"] <- ifelse(original_data[, "time"] == 1,
"baseline", "follow-up")
original_data$group <- as.factor(original_data$Group)
original_data$time <- as.factor(original_data$time)
original_data$sex <- as.factor(original_data$v_236)
original_data[["SCON"]] <-
abs(as.numeric(original_data[["SCON"]]))
original_data[["WFI"]] <-
abs(as.numeric(original_data[["WFI"]]))
original_data[["age_cat"]] <-
ifelse(original_data[["Age"]] < 31, 1,
ifelse(original_data[["Age"]] >= 31 &
original_data[["Age"]] < 41, 2,
ifelse(original_data[["Age"]] >= 41 &
original_data[["Age"]] < 51, 3, 4)))
original_data$age_cat <- factor(original_data[["age_cat"]],
order = TRUE,
levels = c(1, 2, 3, 4))
original_data[["stress"]] <- factor(original_data[["v_534"]],
order = TRUE,
levels = c(1, 2, 3, 4, 5))
original_data <- as.data.frame(original_data)
original_data$.id <- original_data$id
original_data$.imp <- 0
original_data <- original_data[, c(".imp",
".id",
"id",
"group",
"sex",
"age_cat",
"time",
"stress",
"SCON",
"WFI")]
test3 <- rbind(original_data, data_imputed_long)
imp <- as.mids(test3)
test3$.id <- NULL
imp <- as.mids(test3)
test_pooled <- with(imp, glmer(WFI ~ Group * time * I(SCON^2) + Group * time * SCON +
stress + age_cat + sex + (1 | id),
family = Gamma(link = "log")))
test_pooled <- with(imp, glmer(WFI ~ group * time * I(SCON^2) + group * time * SCON +
stress + age_cat + sex + (1 | id),
family = Gamma(link = "log")))
summary(pool(test_pooled))
test_pooled
pool(test_pooled)
install.packages("broom.mixed")
library(broom.mixed)
pool(test_pooled)
summary(pool(test_pooled))
sink("output/mixed_effects_model_02_summary.txt")
print(model_02_summary)
sink("output/mixed_effects_model_02_summary.txt")
summary(pool(test_pooled))
sink()
warnings()
source("R/00_load_packages.R")
source("R/01_load_data.R")
source("R/02_edit_data.R")
source("R/03_impute_data.R")
